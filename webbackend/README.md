# ğŸƒâ€â™‚ï¸ SportRoomOnline Backend

> ä½“è‚²æ´»åŠ¨å®¤åœ¨çº¿ç®¡ç†ç³»ç»Ÿ - åç«¯æœåŠ¡

åŸºäº Midway.js æ¡†æ¶çš„ Node.js + TypeScript åç«¯æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„ RESTful API æ”¯æŒå‰ç«¯åº”ç”¨ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **ç”¨æˆ·ç®¡ç†**: æ³¨å†Œã€ç™»å½•ã€JWTè®¤è¯ã€ä¸ªäººèµ„æ–™
- **æ´»åŠ¨ç®¡ç†**: æ´»åŠ¨CRUDã€æœç´¢ç­›é€‰ã€çŠ¶æ€ç®¡ç†
- **æŠ¥åç³»ç»Ÿ**: åœ¨çº¿æŠ¥åã€å®¡æ ¸æµç¨‹ã€äººæ•°æ§åˆ¶
- **è®¢å•æ”¯ä»˜**: è®¢å•ç®¡ç†ã€æ¨¡æ‹Ÿæ”¯ä»˜ã€é€€æ¬¾å¤„ç†
- **ç¤¾äº¤äº’åŠ¨**: è¯„è®ºè¯„åˆ†ã€ç‚¹èµç³»ç»Ÿã€æƒé™æ§åˆ¶

### ğŸ—ï¸ æŠ€æœ¯æ¶æ„
- **æ¡†æ¶**: Midway.js 3.x (åŸºäº Koa.js)
- **è¯­è¨€**: TypeScript 4.x
- **æ•°æ®åº“**: TypeORM + SQLite (å¼€å‘) / MySQL (ç”Ÿäº§)
- **è®¤è¯**: JWT + bcrypt å¯†ç åŠ å¯†
- **æµ‹è¯•**: Jest å•å…ƒæµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js >= 16.0.0
- npm >= 7.0.0

### å®‰è£…ä¾èµ–
```bash
npm install
```

### å¼€å‘æ¨¡å¼
```bash
npm run dev
# æœåŠ¡å°†åœ¨ http://localhost:7001 å¯åŠ¨
```

### ç”Ÿäº§éƒ¨ç½²
```bash
npm run build
npm start
```

## ğŸ“š API æ–‡æ¡£

### ğŸ” ç”¨æˆ·è®¤è¯ API
```
POST   /api/user/register     - ç”¨æˆ·æ³¨å†Œ
POST   /api/user/login        - ç”¨æˆ·ç™»å½•
GET    /api/user/profile      - è·å–ç”¨æˆ·èµ„æ–™
PUT    /api/user/profile      - æ›´æ–°ç”¨æˆ·èµ„æ–™
POST   /api/user/upload       - ä¸Šä¼ å¤´åƒ
```

### ğŸƒâ€â™‚ï¸ æ´»åŠ¨ç®¡ç† API
```
GET    /api/activity/list     - è·å–æ´»åŠ¨åˆ—è¡¨
GET    /api/activity/:id      - è·å–æ´»åŠ¨è¯¦æƒ…
POST   /api/activity/create   - åˆ›å»ºæ´»åŠ¨
PUT    /api/activity/:id      - æ›´æ–°æ´»åŠ¨
DELETE /api/activity/:id      - åˆ é™¤æ´»åŠ¨
GET    /api/activity/search   - æœç´¢æ´»åŠ¨
```

### ğŸ“ æŠ¥åç®¡ç† API
```
POST   /api/registration/apply         - ç”³è¯·æŠ¥å
GET    /api/registration/my            - æˆ‘çš„æŠ¥å
GET    /api/registration/activity/:id  - æ´»åŠ¨æŠ¥ååˆ—è¡¨
POST   /api/registration/review/:id    - å®¡æ ¸æŠ¥å
DELETE /api/registration/cancel/:id    - å–æ¶ˆæŠ¥å
```

### ğŸ’° è®¢å•æ”¯ä»˜ API
```
POST   /api/order/create/:registrationId  - åˆ›å»ºè®¢å•
GET    /api/order/:id                     - è·å–è®¢å•è¯¦æƒ…
GET    /api/order/my                      - æˆ‘çš„è®¢å•
POST   /api/order/pay/:id                 - æ”¯ä»˜è®¢å•
PUT    /api/order/cancel/:id              - å–æ¶ˆè®¢å•
POST   /api/order/refund/:id              - ç”³è¯·é€€æ¬¾
```

### ğŸ’¬ ç¤¾äº¤äº’åŠ¨ API
```
POST   /api/comment/create            - åˆ›å»ºè¯„è®º
GET    /api/comment/activity/:id      - è·å–æ´»åŠ¨è¯„è®º
GET    /api/comment/my               - æˆ‘çš„è¯„è®º
PUT    /api/comment/:id              - æ›´æ–°è¯„è®º
DELETE /api/comment/:id              - åˆ é™¤è¯„è®º
GET    /api/comment/permission/:id   - æ£€æŸ¥è¯„è®ºæƒé™
POST   /api/comment/:id/like         - åˆ‡æ¢ç‚¹èµçŠ¶æ€
GET    /api/comment/:id/like-status  - æ£€æŸ¥ç‚¹èµçŠ¶æ€
GET    /api/comment/rating/:id       - è·å–æ´»åŠ¨è¯„åˆ†
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒå®ä½“
- **User**: ç”¨æˆ·ä¿¡æ¯
- **Activity**: æ´»åŠ¨ä¿¡æ¯
- **Registration**: æŠ¥åè®°å½•
- **Order**: è®¢å•ä¿¡æ¯
- **Comment**: è¯„è®ºå†…å®¹
- **CommentLike**: ç‚¹èµè®°å½•

### å…³é”®ç‰¹æ€§
- **å”¯ä¸€çº¦æŸ**: CommentLike è¡¨çš„ (userId, commentId) ç¡®ä¿æ¯ç”¨æˆ·æ¯è¯„è®ºåªèƒ½ç‚¹èµä¸€æ¬¡
- **å¤–é”®çº¦æŸ**: å®Œæ•´çš„å…³è”å…³ç³»å’Œçº§è”åˆ é™¤
- **ç´¢å¼•ä¼˜åŒ–**: æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–çš„æ•°æ®åº“ç´¢å¼•

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•
```bash
# å•å…ƒæµ‹è¯•
npm test

# æµ‹è¯•è¦†ç›–ç‡
npm run cov

# ä»£ç æ£€æŸ¥
npm run lint
```

### æµ‹è¯•è¦†ç›–
- æ§åˆ¶å™¨ API æµ‹è¯•
- æœåŠ¡å±‚ä¸šåŠ¡é€»è¾‘æµ‹è¯•
- æ•°æ®åº“æ“ä½œæµ‹è¯•
- è®¤è¯æˆæƒæµ‹è¯•

## ğŸ› ï¸ å¼€å‘è„šæœ¬

```bash
npm run dev          # å¼€å‘æ¨¡å¼ (çƒ­é‡è½½)
npm run build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm start            # å¯åŠ¨ç”Ÿäº§æœåŠ¡
npm run lint         # ä»£ç é£æ ¼æ£€æŸ¥
npm test             # è¿è¡Œæµ‹è¯•
npm run clean        # æ¸…ç†æ„å»ºæ–‡ä»¶
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒé…ç½®
- `config.default.ts`: é»˜è®¤é…ç½®
- `config.unittest.ts`: æµ‹è¯•ç¯å¢ƒé…ç½®
- `config.prod.ts`: ç”Ÿäº§ç¯å¢ƒé…ç½® (éœ€åˆ›å»º)

### å…³é”®é…ç½®é¡¹
- JWTå¯†é’¥å’Œè¿‡æœŸæ—¶é—´
- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- æ–‡ä»¶ä¸Šä¼ é…ç½®
- è·¨åŸŸè®¾ç½®

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **æ•°æ®åº“ç´¢å¼•**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- **åˆ†é¡µæŸ¥è¯¢**: å¤§åˆ—è¡¨æ•°æ®åˆ†é¡µåŠ è½½
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- **ç¼“å­˜ç­–ç•¥**: Redis ç¼“å­˜çƒ­ç‚¹æ•°æ® (å¾…å®ç°)

## ğŸ› è°ƒè¯•æŒ‡å—

### å¼€å‘å·¥å…·
- **æ—¥å¿—**: è¯¦ç»†çš„è¯·æ±‚/å“åº”æ—¥å¿—
- **è°ƒè¯•**: VS Code è°ƒè¯•é…ç½®
- **ç›‘æ§**: ä¸­é—´ä»¶æ€§èƒ½ç›‘æ§

### å¸¸è§é—®é¢˜
1. **æ•°æ®åº“è¿æ¥**: æ£€æŸ¥ SQLite æ–‡ä»¶æƒé™
2. **ç«¯å£å ç”¨**: é»˜è®¤ 7001 ç«¯å£ï¼Œå¯åœ¨é…ç½®ä¸­ä¿®æ”¹
3. **ä¾èµ–å®‰è£…**: ç¡®ä¿ Node.js ç‰ˆæœ¬å…¼å®¹

---

æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ [Midway.js å®˜æ–¹æ–‡æ¡£](https://midwayjs.org)
